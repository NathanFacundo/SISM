

@*DATATABLES*@
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script type="text/javascript" src="~/Scripts/2023/jquery.min.js"></script>

<link rel="stylesheet" href="https://cdn.datatables.net/1.10.24/css/jquery.dataTables.min.css" />
<link rel=¨stylesheet¨ href="~/Scripts/2023/jquery.dataTables.min.css">

<script src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="~/Scripts/2023/jquery.dataTables.min.js"></script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css">
<link rel=¨stylesheet¨ href="~/Scripts/2023/bootstrap-icons.css">

@*CSS only*@
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
<link rel=¨stylesheet¨ href="~/Scripts/2023/bootstrap.min.css">

@*JavaScript Bundle with Popper*@
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js" integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous"></script>
<script type="text/javascript" src="~/Scripts/2023/bootstrap.bundle.min.js"></script>

<script src="~/JavaScript/jquery.tablesorter.js" type="text/javascript"></script>

@*SWAL FIRE*@
<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script type="text/javascript" src="~/Scripts/2023/sweetalert2@11.js"></script>

<row class="row m-0">
    <div class="col-md-12" id="menu">
        <table>
            <tr>
                <td><a href="@Url.Action("Index", "Home")"><b>Inicio</b></a></td>
                <td> <span class="material-icons">keyboard_arrow_right</span></td>
                <td><a href="@Url.Action("Medico", "Manage")"><b>Médico</b></a></td>
                <td> <span class="material-icons">keyboard_arrow_right</span></td>
                <td><a href="@Url.Action("ComprasMenu", "OrdenCompra")"><b>Menú Compras</b></a></td>
                <td> <span class="material-icons">keyboard_arrow_right</span></td>
            </tr>
        </table>
    </div>
</row>

<div class="container mt-5">
    <!-- Título centrado -->
    <div class="row justify-content-center">
        <div class="col-md-12 text-center">
            <h2 class="mb-4">Alta de Proveedor</h2>
        </div>
    </div>

    <!-- Formulario de alta de proveedor -->
    <div class="card shadow">
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="NomProv" class="font-weight-bold">Nombre del Proveedor:</label>
                        <input type="text" class="form-control" id="NomProv" placeholder="Escribe el nombre">
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="PadronProv" class="font-weight-bold">Padrón del Proveedor:</label>
                        <input type="text" class="form-control" id="PadronProv" placeholder="Escribe el padrón">
                    </div>
                </div>
            </div>

            <!-- Botones de acción centrados -->
            <div class="row mt-3 justify-content-center">
                <div class="col-auto">
                    <button type="button" class="btn btn-secondary px-4" onclick="CerrarProv()">Cerrar/Cancelar</button>
                </div>
                <div class="col-auto">
                    <button type="button" class="btn btn-primary px-4" onclick="GuardarProv()">Guardar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Tabla de proveedores -->
    <div class="row mt-5">
        <div class="col-md-12">
            <h4 class="mb-4 text-center">Lista de Proveedores</h4>
            <div class="table-responsive">
                <table class="table table-striped table-hover text-center" id="tbl_proveedores">
                    <thead class="thead-dark">
                        <tr>
                            <th>#</th>
                            <th>Nombre del Proveedor</th>
                            <th>Padrón del Proveedor</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Aquí irán los datos dinámicos -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Botón adicional para cerrar -->
    <div class="row justify-content-center mt-4">
        <div class="col-auto">
            <button type="button" class="btn btn-secondary px-4" onclick="CerrarProv()">Cerrar/Cancelar</button>
        </div>
    </div>
</div>

<script>

    $(document).ready(function () {

        Swal.fire({
            title: 'Realizando búsqueda',
            allowOutsideClick: false, // Previene cerrar el Swal haciendo clic fuera de él
            didOpen: () => {
                Swal.showLoading(); // Muestra una animación de carga
            }
        });

        $.ajax({
            url: '@Url.Action("ObtenerProveedores_OC", "OrdenCompra")',
            method: 'POST',
            dataType: 'json',
            success: function (data) {

                Swal.close();

                if (data.MENSAJE.substring(0, 6) == "Error:") {
                    Swal.fire({
                        icon: 'error',
                        title: 'Oops... ¡Error!',
                        text: data.MENSAJE.substring(7),
                    });
                }
                else {
                    LlenaTablaProv(data.PROV);
                }
            },
            error: function (ex) {

                Swal.close();

                Swal.fire({
                    icon: 'error',
                    title: '¡Error!',
                });
            }
        });

        function LlenaTablaProv(Lista) {
            var table = $('#tbl_proveedores').DataTable();
            table.destroy();

            table = $('#tbl_proveedores').DataTable({
                responsive: true,
                searching: true,
                info: true,
                deferRender: true,
                scroller: true,
                scrollColapse: true,
                paging: false,
                lengthChange: false,
                language: {
                    "zeroRecords": "No se encontraron registros",
                    "search": "Buscador",
                    "info": "_TOTAL_  Proveedores",
                    "infoEmpty": "",
                    "paginate": {
                        "first": "Primero",
                        "last": "Último",
                        "next": "Siguiente",
                        "previous": "Anterior",
                    },
                    "select": {
                        "rows": " %d filas seleccionadas"
                    },
                },
                data: Lista,
                "order": [[0, 'desc']],
                columns: [
                    { 'data': 'Id_OC', className: "text-center" },
                    { 'data': 'NombreProveedor', className: "text-center" },
                    { 'data': 'UanlProv', className: "text-center" }
                ],
                dom: 'Bfrtip',
                buttons: [
                    { extend: 'excel', text: 'Descargar a Excel' }
                ]
            });
        }

    });

    function CerrarProv() {
        location.reload();
    }

    function GuardarProv() {
        var NomProv = $("#NomProv").val();
        var PadronProv = $("#PadronProv").val();

        if (NomProv != "" && PadronProv != "") {
            $.ajax({
                url: '@Url.Action("GuardarProveedor", "OrdenCompra")',
                method: 'POST',
                dataType: 'json',
                data: { NomProv: NomProv, PadronProv: PadronProv },
                success: function (data) {
                    if (data.MENSAJE.substring(0, 6) == "Succe:") {
                        Swal.fire({
                            icon: 'success',
                            title: '¡Éxito!',
                            text: data.MENSAJE.substring(7),
                            willClose: () => {
                                location.reload();
                            }
                        });
                    }
                    if (data.MENSAJE.substring(0, 6) == "Error:") {
                        Swal.fire({
                            icon: 'error',
                            title: '¡Error!',
                            text: data.MENSAJE.substring(7),
                        });
                    }
                },
                error: function (ex) {
                    Swal.fire({
                        icon: 'error',
                        title: '¡Error!',
                    });
                }
            });
        } else {
            Swal.fire({
                icon: 'error',
                title: '¡Error!',
                text: 'Debe ingresar los datos del Proveedor'
            });
        }
    }

</script>


